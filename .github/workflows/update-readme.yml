name: âœ¨ Update README

on:
  push:
    branches:
      - main
    paths:
      - 'README.md'  # ğŸš€ Ğ—Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ README.md
  schedule:
    - cron: '0 0 * * 0'  # â° Ğ•Ğ¶ĞµĞ½ĞµĞ´ĞµĞ»ÑŒĞ½Ñ‹Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ² Ğ²Ğ¾ÑĞºÑ€ĞµÑĞµĞ½ÑŒĞµ Ğ² 00:00 UTC
  workflow_dispatch:  # ğŸ–ï¸ Ğ ÑƒÑ‡Ğ½Ğ¾Ğ¹ Ğ·Ğ°Ğ¿ÑƒÑĞº

jobs:
  update-readme-and-badges:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.PAT_TOKEN }}

      - name: ğŸ› ï¸ Set up Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '16'

      - name: ğŸ”§ Setup Git
        run: |
          git config user.name "GitHub Action"
          git config user.email "action@github.com"

      - name: ğŸ“ Update README with timestamp and badges
        run: |
          # â³ ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ¼ĞµÑ‚ĞºĞ¸ Ğ±ĞµĞ¹Ğ´Ğ¶ĞµĞ¹
          TIMESTAMP=$(date +%s)
          sed -i "s|\(https://api.catgirllover.ru/api/badge/Reverse-Collapse-RUS/[1-5]/progress/?t=\)[0-9]\+|\1$TIMESTAMP|g" README.md
          echo "âœ… Updated badges with timestamp: $TIMESTAMP"
          
          # ğŸ“… ĞĞ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ»Ğ¸ Ğ´Ğ¾Ğ±Ğ°Ğ²Ğ»ĞµĞ½Ğ¸Ğµ ÑÑ‚Ñ€Ğ¾ĞºĞ¸ "ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ"
          if grep -q "âœ¨ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:" README.md; then
            sed -i "s|âœ¨ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ:.*|âœ¨ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: $(date)|" README.md
            echo "ğŸ”„ Updated existing last update line"
          else
            echo "âœ¨ ĞŸĞ¾ÑĞ»ĞµĞ´Ğ½ĞµĞµ Ğ¾Ğ±Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ: $(date)" >> README.md
            echo "â• Added new last update line"
          fi

      - name: ğŸ’¾ Commit and Push changes
        run: |
          git add README.md
          echo "ğŸ” Checking for changes in README.md"
          if ! git diff --quiet README.md; then
            git commit -m "ğŸ‰ Updated badges and README - $TIMESTAMP [skip ci]"
            git push
            echo "âœ… Changes committed and pushed"
          else
            echo "âš ï¸ No changes to commit"
          fi
